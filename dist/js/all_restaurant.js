/**
 * Common database helper functions.
 */
class DBHelper {

  /**
   * Database URL.
   * Change this to restaurants.json file location on your server.
   */
  static get DATABASE_URL() {
    const port = 1337; // Change this to your server port
    return `http://localhost:${port}/restaurants`;
  }

  /**
   * Fetch all restaurants.
   */
  /*static fetchRestaurants(callback) {
    let xhr = new XMLHttpRequest();
    xhr.open('GET', DBHelper.DATABASE_URL);
    xhr.onload = () => {
      if (xhr.status === 200) { // Got a success response from server!
        const json = JSON.parse(xhr.responseText);
        console.log(json);
        console.log(typeof json);
        const restaurants = json;
        callback(null, restaurants);
      } else { // Oops!. Got an error from server.
        const error = (`Request failed. Returned status of ${xhr.status}`);
        callback(error, null);
      }
    };
    xhr.send();
  }*/

  static fetchRestaurants(callback) {
    fetch(DBHelper.DATABASE_URL).then(response => response.json()).then(json => {
      const restaurants = json;
      callback(null, restaurants);
    }).catch(e => {
      const error = `Request failed. Returned status of ${e}`;
      console.log(error);
      callback(error, null);
    });
  }

  /**
   * Fetch a restaurant by its ID.
   */
  static fetchRestaurantById(id, callback) {
    // fetch all restaurants with proper error handling.
    DBHelper.fetchRestaurants((error, restaurants) => {
      if (error) {
        callback(error, null);
      } else {
        const restaurant = restaurants.find(r => r.id == id);
        if (restaurant) {
          // Got the restaurant
          callback(null, restaurant);
        } else {
          // Restaurant does not exist in the database
          callback('Restaurant does not exist', null);
        }
      }
    });
  }

  /**
   * Fetch restaurants by a cuisine type with proper error handling.
   */
  static fetchRestaurantByCuisine(cuisine, callback) {
    // Fetch all restaurants  with proper error handling
    DBHelper.fetchRestaurants((error, restaurants) => {
      if (error) {
        callback(error, null);
      } else {
        // Filter restaurants to have only given cuisine type
        const results = restaurants.filter(r => r.cuisine_type == cuisine);
        callback(null, results);
      }
    });
  }

  /**
   * Fetch restaurants by a neighborhood with proper error handling.
   */
  static fetchRestaurantByNeighborhood(neighborhood, callback) {
    // Fetch all restaurants
    DBHelper.fetchRestaurants((error, restaurants) => {
      if (error) {
        callback(error, null);
      } else {
        // Filter restaurants to have only given neighborhood
        const results = restaurants.filter(r => r.neighborhood == neighborhood);
        callback(null, results);
      }
    });
  }

  /**
   * Fetch restaurants by a cuisine and a neighborhood with proper error handling.
   */
  static fetchRestaurantByCuisineAndNeighborhood(cuisine, neighborhood, callback) {
    // Fetch all restaurants
    DBHelper.fetchRestaurants((error, restaurants) => {
      if (error) {
        callback(error, null);
      } else {
        let results = restaurants;
        if (cuisine != 'all') {
          // filter by cuisine
          results = results.filter(r => r.cuisine_type == cuisine);
        }
        if (neighborhood != 'all') {
          // filter by neighborhood
          results = results.filter(r => r.neighborhood == neighborhood);
        }
        callback(null, results);
      }
    });
  }

  /**
   * Fetch all neighborhoods with proper error handling.
   */
  static fetchNeighborhoods(callback) {
    // Fetch all restaurants
    DBHelper.fetchRestaurants((error, restaurants) => {
      if (error) {
        callback(error, null);
      } else {
        // Get all neighborhoods from all restaurants
        const neighborhoods = restaurants.map((v, i) => restaurants[i].neighborhood);
        // Remove duplicates from neighborhoods
        const uniqueNeighborhoods = neighborhoods.filter((v, i) => neighborhoods.indexOf(v) == i);
        callback(null, uniqueNeighborhoods);
      }
    });
  }

  /**
   * Fetch all cuisines with proper error handling.
   */
  static fetchCuisines(callback) {
    // Fetch all restaurants
    DBHelper.fetchRestaurants((error, restaurants) => {
      if (error) {
        callback(error, null);
      } else {
        // Get all cuisines from all restaurants
        const cuisines = restaurants.map((v, i) => restaurants[i].cuisine_type);
        // Remove duplicates from cuisines
        const uniqueCuisines = cuisines.filter((v, i) => cuisines.indexOf(v) == i);
        callback(null, uniqueCuisines);
      }
    });
  }

  /**
   * Restaurant page URL.
   */
  static urlForRestaurant(restaurant) {
    return `./restaurant.html?id=${restaurant.id}`;
  }

  /**
   * Restaurant image URL.
   */
  static imageUrlForRestaurant(restaurant) {
    return `/img/${restaurant.photograph}`;
  }

  /**
   * Map marker for a restaurant.
   */
  static mapMarkerForRestaurant(restaurant, map) {
    const marker = new google.maps.Marker({
      position: restaurant.latlng,
      title: restaurant.name,
      url: DBHelper.urlForRestaurant(restaurant),
      map: map,
      animation: google.maps.Animation.DROP });
    return marker;
  }

}
let restaurant;
var map;

/**
 * Initialize Google map, called from HTML.
 */
window.initMap = () => {
  fetchRestaurantFromURL((error, restaurant) => {
    if (error) {
      // Got an error!
      console.error(error);
    } else {
      self.map = new google.maps.Map(document.getElementById('map'), {
        zoom: 16,
        center: restaurant.latlng,
        scrollwheel: false
      });
      fillBreadcrumb();
      DBHelper.mapMarkerForRestaurant(self.restaurant, self.map);
    }
  });
};

/**
 * Get current restaurant from page URL.
 */
fetchRestaurantFromURL = callback => {
  if (self.restaurant) {
    // restaurant already fetched!
    callback(null, self.restaurant);
    return;
  }
  const id = getParameterByName('id');
  if (!id) {
    // no id found in URL
    error = 'No restaurant id in URL';
    callback(error, null);
  } else {
    DBHelper.fetchRestaurantById(id, (error, restaurant) => {
      self.restaurant = restaurant;
      if (!restaurant) {
        console.error(error);
        return;
      }
      fillRestaurantHTML();
      callback(null, restaurant);
    });
  }
};

/**
 * Create restaurant HTML and add it to the webpage
 */
fillRestaurantHTML = (restaurant = self.restaurant) => {
  const name = document.getElementById('restaurant-name');
  name.innerHTML = restaurant.name;

  const address = document.getElementById('restaurant-address');
  address.innerHTML = restaurant.address;

  const image = document.getElementById('restaurant-img');
  image.className = 'restaurant-img';
  image.src = DBHelper.imageUrlForRestaurant(restaurant);
  image.setAttribute("srcset", `/img_resp/${restaurant.id}-400.jpg 1x, /img_resp/${restaurant.id}-800.jpg 2x`);
  image.setAttribute("alt", restaurant.alt);

  const cuisine = document.getElementById('restaurant-cuisine');
  cuisine.innerHTML = restaurant.cuisine_type;

  // fill operating hours
  if (restaurant.operating_hours) {
    fillRestaurantHoursHTML();
  }
  // fill reviews
  fillReviewsHTML();
};

/**
 * Create restaurant operating hours HTML table and add it to the webpage.
 */
fillRestaurantHoursHTML = (operatingHours = self.restaurant.operating_hours) => {
  const hours = document.getElementById('restaurant-hours');
  for (let key in operatingHours) {
    const row = document.createElement('tr');

    const day = document.createElement('td');
    day.innerHTML = key;
    row.appendChild(day);

    const time = document.createElement('td');
    time.innerHTML = operatingHours[key];
    row.appendChild(time);

    hours.appendChild(row);
  }
};

/**
 * Create all reviews HTML and add them to the webpage.
 */
fillReviewsHTML = (reviews = self.restaurant.reviews) => {
  const container = document.getElementById('reviews-container');
  const title = document.createElement('h2');
  title.innerHTML = 'Reviews';
  container.appendChild(title);

  if (!reviews) {
    const noReviews = document.createElement('p');
    noReviews.innerHTML = 'No reviews yet!';
    container.appendChild(noReviews);
    return;
  }
  const ul = document.getElementById('reviews-list');
  reviews.forEach(review => {
    ul.appendChild(createReviewHTML(review));
  });
  container.appendChild(ul);
};

/**
 * Create review HTML and add it to the webpage.
 */
createReviewHTML = review => {
  const li = document.createElement('li');
  const name = document.createElement('p');
  name.setAttribute("class", "rev-name");
  name.innerHTML = review.name;
  li.appendChild(name);

  const date = document.createElement('p');
  date.setAttribute("class", "rev-date");
  date.innerHTML = review.date;
  li.appendChild(date);

  const rating = document.createElement('p');
  rating.setAttribute("class", "rev-rating");
  rating.innerHTML = `Rating: ${review.rating}`;
  li.appendChild(rating);

  const comments = document.createElement('p');
  comments.setAttribute("class", "rev-comments");
  comments.innerHTML = review.comments;
  li.appendChild(comments);

  return li;
};

/**
 * Add restaurant name to the breadcrumb navigation menu
 */
fillBreadcrumb = (restaurant = self.restaurant) => {
  const breadcrumb = document.getElementById('breadcrumb');
  const li = document.createElement('li');
  li.innerHTML = restaurant.name;
  breadcrumb.appendChild(li);
};

/**
 * Get a parameter by name from page URL.
 */
getParameterByName = (name, url) => {
  if (!url) url = window.location.href;
  name = name.replace(/[\[\]]/g, '\\$&');
  const regex = new RegExp(`[?&]${name}(=([^&#]*)|&|#|$)`),
        results = regex.exec(url);
  if (!results) return null;
  if (!results[2]) return '';
  return decodeURIComponent(results[2].replace(/\+/g, ' '));
};
var _this = this;

setTimeout(() => {}, 5000);
removeTabfocusFromMap = () => {
  window.onload = () => {
    const gmap = document.querySelector('#map');
    gmapDesc = gmap.querySelectorAll('*');
    gmapDesc.forEach(desc => {
      desc.setAttribute("tabindex", "-1");
    }, _this);
  };
};
document.getElementById("map").onload = removeTabfocusFromMap();

window.onload = () => {
  const iframe = document.querySelector('iframe');
  iframe.title = "Google Maps";
};

/**
 * Register a serviceWorker
 */
registerServiceWorker = () => {
  //check if serviceWorker is supported, otherwise return
  if (!navigator.serviceWorker) return;

  navigator.serviceWorker.register('/sw.js').catch(function () {
    console.log("Something went wrong. ServiceWorker not registered");
  });
};

registerServiceWorker();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImRiaGVscGVyLmpzIiwicmVzdGF1cmFudF9pbmZvLmpzIiwiZ29vZ2xlTWFwc0ZvY3VzLmpzIiwicmVnaXN0ZXJTZXJ2aWNlV29ya2VyLmpzIl0sIm5hbWVzIjpbIkRCSGVscGVyIiwiREFUQUJBU0VfVVJMIiwicG9ydCIsImZldGNoUmVzdGF1cmFudHMiLCJjYWxsYmFjayIsImZldGNoIiwidGhlbiIsInJlc3BvbnNlIiwianNvbiIsInJlc3RhdXJhbnRzIiwiY2F0Y2giLCJlIiwiZXJyb3IiLCJjb25zb2xlIiwibG9nIiwiZmV0Y2hSZXN0YXVyYW50QnlJZCIsImlkIiwicmVzdGF1cmFudCIsImZpbmQiLCJyIiwiZmV0Y2hSZXN0YXVyYW50QnlDdWlzaW5lIiwiY3Vpc2luZSIsInJlc3VsdHMiLCJmaWx0ZXIiLCJjdWlzaW5lX3R5cGUiLCJmZXRjaFJlc3RhdXJhbnRCeU5laWdoYm9yaG9vZCIsIm5laWdoYm9yaG9vZCIsImZldGNoUmVzdGF1cmFudEJ5Q3Vpc2luZUFuZE5laWdoYm9yaG9vZCIsImZldGNoTmVpZ2hib3Job29kcyIsIm5laWdoYm9yaG9vZHMiLCJtYXAiLCJ2IiwiaSIsInVuaXF1ZU5laWdoYm9yaG9vZHMiLCJpbmRleE9mIiwiZmV0Y2hDdWlzaW5lcyIsImN1aXNpbmVzIiwidW5pcXVlQ3Vpc2luZXMiLCJ1cmxGb3JSZXN0YXVyYW50IiwiaW1hZ2VVcmxGb3JSZXN0YXVyYW50IiwicGhvdG9ncmFwaCIsIm1hcE1hcmtlckZvclJlc3RhdXJhbnQiLCJtYXJrZXIiLCJnb29nbGUiLCJtYXBzIiwiTWFya2VyIiwicG9zaXRpb24iLCJsYXRsbmciLCJ0aXRsZSIsIm5hbWUiLCJ1cmwiLCJhbmltYXRpb24iLCJBbmltYXRpb24iLCJEUk9QIiwid2luZG93IiwiaW5pdE1hcCIsImZldGNoUmVzdGF1cmFudEZyb21VUkwiLCJzZWxmIiwiTWFwIiwiZG9jdW1lbnQiLCJnZXRFbGVtZW50QnlJZCIsInpvb20iLCJjZW50ZXIiLCJzY3JvbGx3aGVlbCIsImZpbGxCcmVhZGNydW1iIiwiZ2V0UGFyYW1ldGVyQnlOYW1lIiwiZmlsbFJlc3RhdXJhbnRIVE1MIiwiaW5uZXJIVE1MIiwiYWRkcmVzcyIsImltYWdlIiwiY2xhc3NOYW1lIiwic3JjIiwic2V0QXR0cmlidXRlIiwiYWx0Iiwib3BlcmF0aW5nX2hvdXJzIiwiZmlsbFJlc3RhdXJhbnRIb3Vyc0hUTUwiLCJmaWxsUmV2aWV3c0hUTUwiLCJvcGVyYXRpbmdIb3VycyIsImhvdXJzIiwia2V5Iiwicm93IiwiY3JlYXRlRWxlbWVudCIsImRheSIsImFwcGVuZENoaWxkIiwidGltZSIsInJldmlld3MiLCJjb250YWluZXIiLCJub1Jldmlld3MiLCJ1bCIsImZvckVhY2giLCJyZXZpZXciLCJjcmVhdGVSZXZpZXdIVE1MIiwibGkiLCJkYXRlIiwicmF0aW5nIiwiY29tbWVudHMiLCJicmVhZGNydW1iIiwibG9jYXRpb24iLCJocmVmIiwicmVwbGFjZSIsInJlZ2V4IiwiUmVnRXhwIiwiZXhlYyIsImRlY29kZVVSSUNvbXBvbmVudCIsInNldFRpbWVvdXQiLCJyZW1vdmVUYWJmb2N1c0Zyb21NYXAiLCJvbmxvYWQiLCJnbWFwIiwicXVlcnlTZWxlY3RvciIsImdtYXBEZXNjIiwicXVlcnlTZWxlY3RvckFsbCIsImRlc2MiLCJpZnJhbWUiLCJyZWdpc3RlclNlcnZpY2VXb3JrZXIiLCJuYXZpZ2F0b3IiLCJzZXJ2aWNlV29ya2VyIiwicmVnaXN0ZXIiXSwibWFwcGluZ3MiOiJBQUFBOzs7QUFHQSxNQUFNQSxRQUFOLENBQWU7O0FBRWI7Ozs7QUFJQSxhQUFXQyxZQUFYLEdBQTBCO0FBQ3hCLFVBQU1DLE9BQU8sSUFBYixDQUR3QixDQUNOO0FBQ2xCLFdBQVEsb0JBQW1CQSxJQUFLLGNBQWhDO0FBQ0Q7O0FBRUQ7OztBQUdBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFtQkEsU0FBT0MsZ0JBQVAsQ0FBd0JDLFFBQXhCLEVBQWtDO0FBQ2hDQyxVQUFNTCxTQUFTQyxZQUFmLEVBQ0NLLElBREQsQ0FDTUMsWUFBWUEs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Q0FBdUIsTUFBdkIsQ0FBYjtBQUNBQyxlQUFXRixLQUFLRyxnQkFBTCxDQUFzQixHQUF0QixDQUFYO0FBQ0FELGFBQVNwQixPQUFULENBQW1Cc0IsSUFBRCxJQUFTO0FBQ3pCQSxXQUFLdkMsWUFBTCxDQUFrQixVQUFsQixFQUE4QixJQUE5QjtBQUNELEtBRkQ7QUFHRCxHQU5EO0FBT0QsQ0FSRDtBQVNBYixTQUFTQyxjQUFULENBQXdCLEtBQXhCLEVBQStCOEMsTUFBL0IsR0FBd0NELHVCQUF4Qzs7QUFFQW5ELE9BQU9vRCxNQUFQLEdBQWdCLE1BQUs7QUFDbkIsUUFBTU0sU0FBU3JELFNBQVNpRCxhQUFULENBQXVCLFFBQXZCLENBQWY7QUFDQUksU0FBT2hFLEtBQVAsR0FBZSxhQUFmO0FBQ0QsQ0FIRDs7QUNYRjs7O0FBR0FpRSx3QkFBd0IsTUFBTTtBQUMxQjtBQUNBLE1BQUksQ0FBQ0MsVUFBVUMsYUFBZixFQUE4Qjs7QUFFOUJELFlBQVVDLGFBQVYsQ0FBd0JDLFFBQXhCLENBQWlDLFFBQWpDLEVBQTJDMUcsS0FBM0MsQ0FBaUQsWUFBVTtBQUN6REcsWUFBUUMsR0FBUixDQUFZLG9EQUFaO0FBQ0QsR0FGRDtBQUdELENBUEg7O0FBU0VtRyIsImZpbGUiOiJhbGxfcmVzdGF1cmFudC5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxyXG4gKiBDb21tb24gZGF0YWJhc2UgaGVscGVyIGZ1bmN0aW9ucy5cclxuICovXHJcbmNsYXNzIERCSGVscGVyIHtcclxuXHJcbiAgLyoqXHJcbiAgICogRGF0YWJhc2UgVVJMLlxyXG4gICAqIENoYW5nZSB0aGlzIHRvIHJlc3RhdXJhbnRzLmpzb24gZmlsZSBsb2NhdGlvbiBvbiB5b3VyIHNlcnZlci5cclxuICAgKi9cclxuICBzdGF0aWMgZ2V0IERBVEFCQVNFX1VSTCgpIHtcclxuICAgIGNvbnN0IHBvcnQgPSAxMzM3IC8vIENoYW5nZSB0aGlzIHRvIHlvdXIgc2VydmVyIHBvcnRcclxuICAgIHJldHVybiBgaHR0cDovL2xvY2FsaG9zdDoke3BvcnR9L3Jlc3RhdXJhbnRzYDtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEZldGNoIGFsbCByZXN0YXVyYW50cy5cclxuICAgKi9cclxuICAvKnN0YXRpYyBmZXRjaFJlc3RhdXJhbnRzKGNhbGxiYWNrKSB7XHJcbiAgICBsZXQgeGhyID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7XHJcbiAgICB4aHIub3BlbignR0VUJywgREJIZWxwZXIuREFUQUJBU0VfVVJMKTtcclxuICAgIHhoci5vbmxvYWQgPSAoKSA9PiB7XHJcbiAgICAgIGlmICh4aHIuc3RhdHVzID09PSAyMDApIHsgLy8gR290IGEgc3VjY2VzcyByZXNwb25zZSBmcm9tIHNlcnZlciFcclxuICAgICAgICBjb25zdCBqc29uID0gSlNPTi5wYXJzZSh4aHIucmVzcG9uc2VUZXh0KTtcclxuICAgICAgICBjb25zb2xlLmxvZyhqc29uKTtcclxuICAgICAgICBjb25zb2xlLmxvZyh0eXBlb2YganNvbik7XHJcbiAgICAgICAgY29uc3QgcmVzdGF1cmFudHMgPSBqc29uO1xyXG4gICAgICAgIGNhbGxiYWNrKG51bGwsIHJlc3RhdXJhbnRzKTtcclxuICAgICAgfSBlbHNlIHsgLy8gT29wcyEuIEdvdCBhbiBlcnJvciBmcm9tIHNlcnZlci5cclxuICAgICAgICBjb25zdCBlcnJvciA9IChgUmVxdWVzdCBmYWlsZWQuIFJldHVybmVkIHN0YXR1cyBvZiAke3hoci5zdGF0dXN9YCk7XHJcbiAgICAgICAgY2FsbGJhY2soZXJyb3IsIG51bGwpO1xyXG4gICAgICB9XHJcbiAgICB9O1xyXG4gICAgeGhyLnNlbmQoKTtcclxuICB9Ki9cclxuXHJcblxyXG4gIHN0YXRpYyBmZXRjaFJlc3RhdXJhbnRzKGNhbGxiYWNrKSB7XHJcbiAgICBmZXRjaChEQkhlbHBlci5EQVRBQkFTRV9VUkwpXHJcbiAgICAudGhlbihyZXNwb25zZSA9PiByZXNwb25zZS5qc29uKCkpXHJcbiAgICAudGhlbihqc29uID0+e1xyXG4gICAgICBjb25zdCByZXN0YXVyYW50cyA9IGpzb247XHJcbiAgICAgIGNhbGxiYWNrKG51bGwsIHJlc3RhdXJhbnRzKTtcclxuICAgIH0pXHJcbiAgICAuY2F0Y2goZSA9PntcclxuICAgICAgY29uc3QgZXJyb3IgPSAoYFJlcXVlc3QgZmFpbGVkLiBSZXR1cm5lZCBzdGF0dXMgb2YgJHtlfWApO1xyXG4gICAgICBjb25zb2xlLmxvZyhlcnJvcik7XHJcbiAgICAgIGNhbGxiYWNrKGVycm9yLCBudWxsKTtcclxuICAgIH0pO1xyXG4gXHJcbiAgfVxyXG5cclxuXHJcbiAgLyoqXHJcbiAgICogRmV0Y2ggYSByZXN0YXVyYW50IGJ5IGl0cyBJRC5cclxuICAgKi9cclxuICBzdGF0aWMgZmV0Y2hSZXN0YXVyYW50QnlJZChpZCwgY2FsbGJhY2spIHtcclxuICAgIC8vIGZldGNoIGFsbCByZXN0YXVyYW50cyB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZy5cclxuICAgIERCSGVscGVyLmZldGNoUmVzdGF1cmFudHMoKGVycm9yLCByZXN0YXVyYW50cykgPT4ge1xyXG4gICAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgICBjYWxsYmFjayhlcnJvciwgbnVsbCk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgY29uc3QgcmVzdGF1cmFudCA9IHJlc3RhdXJhbnRzLmZpbmQociA9PiByLmlkID09IGlkKTtcclxuICAgICAgICBpZiAocmVzdGF1cmFudCkgeyAvLyBHb3QgdGhlIHJlc3RhdXJhbnRcclxuICAgICAgICAgIGNhbGxiYWNrKG51bGwsIHJlc3RhdXJhbnQpO1xyXG4gICAgICAgIH0gZWxzZSB7IC8vIFJlc3RhdXJhbnQgZG9lcyBub3QgZXhpc3QgaW4gdGhlIGRhdGFiYXNlXHJcbiAgICAgICAgICBjYWxsYmFjaygnUmVzdGF1cmFudCBkb2VzIG5vdCBleGlzdCcsIG51bGwpO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBGZXRjaCByZXN0YXVyYW50cyBieSBhIGN1aXNpbmUgdHlwZSB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZy5cclxuICAgKi9cclxuICBzdGF0aWMgZmV0Y2hSZXN0YXVyYW50QnlDdWlzaW5lKGN1aXNpbmUsIGNhbGxiYWNrKSB7XHJcbiAgICAvLyBGZXRjaCBhbGwgcmVzdGF1cmFudHMgIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nXHJcbiAgICBEQkhlbHBlci5mZXRjaFJlc3RhdXJhbnRzKChlcnJvciwgcmVzdGF1cmFudHMpID0+IHtcclxuICAgICAgaWYgKGVycm9yKSB7XHJcbiAgICAgICAgY2FsbGJhY2soZXJyb3IsIG51bGwpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIC8vIEZpbHRlciByZXN0YXVyYW50cyB0byBoYXZlIG9ubHkgZ2l2ZW4gY3Vpc2luZSB0eXBlXHJcbiAgICAgICAgY29uc3QgcmVzdWx0cyA9IHJlc3RhdXJhbnRzLmZpbHRlcihyID0+IHIuY3Vpc2luZV90eXBlID09IGN1aXNpbmUpO1xyXG4gICAgICAgIGNhbGxiYWNrKG51bGwsIHJlc3VsdHMpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEZldGNoIHJlc3RhdXJhbnRzIGJ5IGEgbmVpZ2hib3Job29kIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxyXG4gICAqL1xyXG4gIHN0YXRpYyBmZXRjaFJlc3RhdXJhbnRCeU5laWdoYm9yaG9vZChuZWlnaGJvcmhvb2QsIGNhbGxiYWNrKSB7XHJcbiAgICAvLyBGZXRjaCBhbGwgcmVzdGF1cmFudHNcclxuICAgIERCSGVscGVyLmZldGNoUmVzdGF1cmFudHMoKGVycm9yLCByZXN0YXVyYW50cykgPT4ge1xyXG4gICAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgICBjYWxsYmFjayhlcnJvciwgbnVsbCk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgLy8gRmlsdGVyIHJlc3RhdXJhbnRzIHRvIGhhdmUgb25seSBnaXZlbiBuZWlnaGJvcmhvb2RcclxuICAgICAgICBjb25zdCByZXN1bHRzID0gcmVzdGF1cmFudHMuZmlsdGVyKHIgPT4gci5uZWlnaGJvcmhvb2QgPT0gbmVpZ2hib3Job29kKTtcclxuICAgICAgICBjYWxsYmFjayhudWxsLCByZXN1bHRzKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBGZXRjaCByZXN0YXVyYW50cyBieSBhIGN1aXNpbmUgYW5kIGEgbmVpZ2hib3Job29kIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxyXG4gICAqL1xyXG4gIHN0YXRpYyBmZXRjaFJlc3RhdXJhbnRCeUN1aXNpbmVBbmROZWlnaGJvcmhvb2QoY3Vpc2luZSwgbmVpZ2hib3Job29kLCBjYWxsYmFjaykge1xyXG4gICAgLy8gRmV0Y2ggYWxsIHJlc3RhdXJhbnRzXHJcbiAgICBEQkhlbHBlci5mZXRjaFJlc3RhdXJhbnRzKChlcnJvciwgcmVzdGF1cmFudHMpID0+IHtcclxuICAgICAgaWYgKGVycm9yKSB7XHJcbiAgICAgICAgY2FsbGJhY2soZXJyb3IsIG51bGwpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGxldCByZXN1bHRzID0gcmVzdGF1cmFudHNcclxuICAgICAgICBpZiAoY3Vpc2luZSAhPSAnYWxsJykgeyAvLyBmaWx0ZXIgYnkgY3Vpc2luZVxyXG4gICAgICAgICAgcmVzdWx0cyA9IHJlc3VsdHMuZmlsdGVyKHIgPT4gci5jdWlzaW5lX3R5cGUgPT0gY3Vpc2luZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChuZWlnaGJvcmhvb2QgIT0gJ2FsbCcpIHsgLy8gZmlsdGVyIGJ5IG5laWdoYm9yaG9vZFxyXG4gICAgICAgICAgcmVzdWx0cyA9IHJlc3VsdHMuZmlsdGVyKHIgPT4gci5uZWlnaGJvcmhvb2QgPT0gbmVpZ2hib3Job29kKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgY2FsbGJhY2sobnVsbCwgcmVzdWx0cyk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRmV0Y2ggYWxsIG5laWdoYm9yaG9vZHMgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcuXHJcbiAgICovXHJcbiAgc3RhdGljIGZldGNoTmVpZ2hib3Job29kcyhjYWxsYmFjaykge1xyXG4gICAgLy8gRmV0Y2ggYWxsIHJlc3RhdXJhbnRzXHJcbiAgICBEQkhlbHBlci5mZXRjaFJlc3RhdXJhbnRzKChlcnJvciwgcmVzdGF1cmFudHMpID0+IHtcclxuICAgICAgaWYgKGVycm9yKSB7XHJcbiAgICAgICAgY2FsbGJhY2soZXJyb3IsIG51bGwpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIC8vIEdldCBhbGwgbmVpZ2hib3Job29kcyBmcm9tIGFsbCByZXN0YXVyYW50c1xyXG4gICAgICAgIGNvbnN0IG5laWdoYm9yaG9vZHMgPSByZXN0YXVyYW50cy5tYXAoKHYsIGkpID0+IHJlc3RhdXJhbnRzW2ldLm5laWdoYm9yaG9vZClcclxuICAgICAgICAvLyBSZW1vdmUgZHVwbGljYXRlcyBmcm9tIG5laWdoYm9yaG9vZHNcclxuICAgICAgICBjb25zdCB1bmlxdWVOZWlnaGJvcmhvb2RzID0gbmVpZ2hib3Job29kcy5maWx0ZXIoKHYsIGkpID0+IG5laWdoYm9yaG9vZHMuaW5kZXhPZih2KSA9PSBpKVxyXG4gICAgICAgIGNhbGxiYWNrKG51bGwsIHVuaXF1ZU5laWdoYm9yaG9vZHMpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEZldGNoIGFsbCBjdWlzaW5lcyB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZy5cclxuICAgKi9cclxuICBzdGF0aWMgZmV0Y2hDdWlzaW5lcyhjYWxsYmFjaykge1xyXG4gICAgLy8gRmV0Y2ggYWxsIHJlc3RhdXJhbnRzXHJcbiAgICBEQkhlbHBlci5mZXRjaFJlc3RhdXJhbnRzKChlcnJvciwgcmVzdGF1cmFudHMpID0+IHtcclxuICAgICAgaWYgKGVycm9yKSB7XHJcbiAgICAgICAgY2FsbGJhY2soZXJyb3IsIG51bGwpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIC8vIEdldCBhbGwgY3Vpc2luZXMgZnJvbSBhbGwgcmVzdGF1cmFudHNcclxuICAgICAgICBjb25zdCBjdWlzaW5lcyA9IHJlc3RhdXJhbnRzLm1hcCgodiwgaSkgPT4gcmVzdGF1cmFudHNbaV0uY3Vpc2luZV90eXBlKVxyXG4gICAgICAgIC8vIFJlbW92ZSBkdXBsaWNhdGVzIGZyb20gY3Vpc2luZXNcclxuICAgICAgICBjb25zdCB1bmlxdWVDdWlzaW5lcyA9IGN1aXNpbmVzLmZpbHRlcigodiwgaSkgPT4gY3Vpc2luZXMuaW5kZXhPZih2KSA9PSBpKVxyXG4gICAgICAgIGNhbGxiYWNrKG51bGwsIHVuaXF1ZUN1aXNpbmVzKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBSZXN0YXVyYW50IHBhZ2UgVVJMLlxyXG4gICAqL1xyXG4gIHN0YXRpYyB1cmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpIHtcclxuICAgIHJldHVybiAoYC4vcmVzdGF1cmFudC5odG1sP2lkPSR7cmVzdGF1cmFudC5pZH1gKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFJlc3RhdXJhbnQgaW1hZ2UgVVJMLlxyXG4gICAqL1xyXG4gIHN0YXRpYyBpbWFnZVVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCkge1xyXG4gICAgcmV0dXJuIChgL2ltZy8ke3Jlc3RhdXJhbnQucGhvdG9ncmFwaH1gKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIE1hcCBtYXJrZXIgZm9yIGEgcmVzdGF1cmFudC5cclxuICAgKi9cclxuICBzdGF0aWMgbWFwTWFya2VyRm9yUmVzdGF1cmFudChyZXN0YXVyYW50LCBtYXApIHtcclxuICAgIGNvbnN0IG1hcmtlciA9IG5ldyBnb29nbGUubWFwcy5NYXJrZXIoe1xyXG4gICAgICBwb3NpdGlvbjogcmVzdGF1cmFudC5sYXRsbmcsXHJcbiAgICAgIHRpdGxlOiByZXN0YXVyYW50Lm5hbWUsXHJcbiAgICAgIHVybDogREJIZWxwZXIudXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KSxcclxuICAgICAgbWFwOiBtYXAsXHJcbiAgICAgIGFuaW1hdGlvbjogZ29vZ2xlLm1hcHMuQW5pbWF0aW9uLkRST1B9XHJcbiAgICApO1xyXG4gICAgcmV0dXJuIG1hcmtlcjtcclxuICB9XHJcblxyXG59XHJcbiIsImxldCByZXN0YXVyYW50O1xyXG52YXIgbWFwO1xyXG5cclxuLyoqXHJcbiAqIEluaXRpYWxpemUgR29vZ2xlIG1hcCwgY2FsbGVkIGZyb20gSFRNTC5cclxuICovXHJcbndpbmRvdy5pbml0TWFwID0gKCkgPT4ge1xyXG4gIGZldGNoUmVzdGF1cmFudEZyb21VUkwoKGVycm9yLCByZXN0YXVyYW50KSA9PiB7XHJcbiAgICBpZiAoZXJyb3IpIHsgLy8gR290IGFuIGVycm9yIVxyXG4gICAgICBjb25zb2xlLmVycm9yKGVycm9yKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHNlbGYubWFwID0gbmV3IGdvb2dsZS5tYXBzLk1hcChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWFwJyksIHtcclxuICAgICAgICB6b29tOiAxNixcclxuICAgICAgICBjZW50ZXI6IHJlc3RhdXJhbnQubGF0bG5nLFxyXG4gICAgICAgIHNjcm9sbHdoZWVsOiBmYWxzZVxyXG4gICAgICB9KTtcclxuICAgICAgZmlsbEJyZWFkY3J1bWIoKTtcclxuICAgICAgREJIZWxwZXIubWFwTWFya2VyRm9yUmVzdGF1cmFudChzZWxmLnJlc3RhdXJhbnQsIHNlbGYubWFwKTtcclxuICAgIH1cclxuICB9KTtcclxufVxyXG5cclxuLyoqXHJcbiAqIEdldCBjdXJyZW50IHJlc3RhdXJhbnQgZnJvbSBwYWdlIFVSTC5cclxuICovXHJcbmZldGNoUmVzdGF1cmFudEZyb21VUkwgPSAoY2FsbGJhY2spID0+IHtcclxuICBpZiAoc2VsZi5yZXN0YXVyYW50KSB7IC8vIHJlc3RhdXJhbnQgYWxyZWFkeSBmZXRjaGVkIVxyXG4gICAgY2FsbGJhY2sobnVsbCwgc2VsZi5yZXN0YXVyYW50KVxyXG4gICAgcmV0dXJuO1xyXG4gIH1cclxuICBjb25zdCBpZCA9IGdldFBhcmFtZXRlckJ5TmFtZSgnaWQnKTtcclxuICBpZiAoIWlkKSB7IC8vIG5vIGlkIGZvdW5kIGluIFVSTFxyXG4gICAgZXJyb3IgPSAnTm8gcmVzdGF1cmFudCBpZCBpbiBVUkwnXHJcbiAgICBjYWxsYmFjayhlcnJvciwgbnVsbCk7XHJcbiAgfSBlbHNlIHtcclxuICAgIERCSGVscGVyLmZldGNoUmVzdGF1cmFudEJ5SWQoaWQsIChlcnJvciwgcmVzdGF1cmFudCkgPT4ge1xyXG4gICAgICBzZWxmLnJlc3RhdXJhbnQgPSByZXN0YXVyYW50O1xyXG4gICAgICBpZiAoIXJlc3RhdXJhbnQpIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKGVycm9yKTtcclxuICAgICAgICByZXR1cm47XHJcbiAgICAgIH1cclxuICAgICAgZmlsbFJlc3RhdXJhbnRIVE1MKCk7XHJcbiAgICAgIGNhbGxiYWNrKG51bGwsIHJlc3RhdXJhbnQpXHJcbiAgICB9KTtcclxuICB9XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBDcmVhdGUgcmVzdGF1cmFudCBIVE1MIGFuZCBhZGQgaXQgdG8gdGhlIHdlYnBhZ2VcclxuICovXHJcbmZpbGxSZXN0YXVyYW50SFRNTCA9IChyZXN0YXVyYW50ID0gc2VsZi5yZXN0YXVyYW50KSA9PiB7XHJcbiAgY29uc3QgbmFtZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN0YXVyYW50LW5hbWUnKTtcclxuICBuYW1lLmlubmVySFRNTCA9IHJlc3RhdXJhbnQubmFtZTtcclxuXHJcbiAgY29uc3QgYWRkcmVzcyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN0YXVyYW50LWFkZHJlc3MnKTtcclxuICBhZGRyZXNzLmlubmVySFRNTCA9IHJlc3RhdXJhbnQuYWRkcmVzcztcclxuXHJcbiAgY29uc3QgaW1hZ2UgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdGF1cmFudC1pbWcnKTtcclxuICBpbWFnZS5jbGFzc05hbWUgPSAncmVzdGF1cmFudC1pbWcnXHJcbiAgaW1hZ2Uuc3JjID0gREJIZWxwZXIuaW1hZ2VVcmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpO1xyXG4gIGltYWdlLnNldEF0dHJpYnV0ZShcInNyY3NldFwiLCBgL2ltZ19yZXNwLyR7cmVzdGF1cmFudC5pZH0tNDAwLmpwZyAxeCwgL2ltZ19yZXNwLyR7cmVzdGF1cmFudC5pZH0tODAwLmpwZyAyeGApO1xyXG4gIGltYWdlLnNldEF0dHJpYnV0ZShcImFsdFwiLCByZXN0YXVyYW50LmFsdCk7XHJcblxyXG4gIGNvbnN0IGN1aXNpbmUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdGF1cmFudC1jdWlzaW5lJyk7XHJcbiAgY3Vpc2luZS5pbm5lckhUTUwgPSByZXN0YXVyYW50LmN1aXNpbmVfdHlwZTtcclxuXHJcbiAgLy8gZmlsbCBvcGVyYXRpbmcgaG91cnNcclxuICBpZiAocmVzdGF1cmFudC5vcGVyYXRpbmdfaG91cnMpIHtcclxuICAgIGZpbGxSZXN0YXVyYW50SG91cnNIVE1MKCk7XHJcbiAgfVxyXG4gIC8vIGZpbGwgcmV2aWV3c1xyXG4gIGZpbGxSZXZpZXdzSFRNTCgpO1xyXG59XHJcblxyXG4vKipcclxuICogQ3JlYXRlIHJlc3RhdXJhbnQgb3BlcmF0aW5nIGhvdXJzIEhUTUwgdGFibGUgYW5kIGFkZCBpdCB0byB0aGUgd2VicGFnZS5cclxuICovXHJcbmZpbGxSZXN0YXVyYW50SG91cnNIVE1MID0gKG9wZXJhdGluZ0hvdXJzID0gc2VsZi5yZXN0YXVyYW50Lm9wZXJhdGluZ19ob3VycykgPT4ge1xyXG4gIGNvbnN0IGhvdXJzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3RhdXJhbnQtaG91cnMnKTtcclxuICBmb3IgKGxldCBrZXkgaW4gb3BlcmF0aW5nSG91cnMpIHtcclxuICAgIGNvbnN0IHJvdyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RyJyk7XHJcblxyXG4gICAgY29uc3QgZGF5ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGQnKTtcclxuICAgIGRheS5pbm5lckhUTUwgPSBrZXk7XHJcbiAgICByb3cuYXBwZW5kQ2hpbGQoZGF5KTtcclxuXHJcbiAgICBjb25zdCB0aW1lID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGQnKTtcclxuICAgIHRpbWUuaW5uZXJIVE1MID0gb3BlcmF0aW5nSG91cnNba2V5XTtcclxuICAgIHJvdy5hcHBlbmRDaGlsZCh0aW1lKTtcclxuXHJcbiAgICBob3Vycy5hcHBlbmRDaGlsZChyb3cpO1xyXG4gIH1cclxufVxyXG5cclxuLyoqXHJcbiAqIENyZWF0ZSBhbGwgcmV2aWV3cyBIVE1MIGFuZCBhZGQgdGhlbSB0byB0aGUgd2VicGFnZS5cclxuICovXHJcbmZpbGxSZXZpZXdzSFRNTCA9IChyZXZpZXdzID0gc2VsZi5yZXN0YXVyYW50LnJldmlld3MpID0+IHtcclxuICBjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmV2aWV3cy1jb250YWluZXInKTtcclxuICBjb25zdCB0aXRsZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2gyJyk7XHJcbiAgdGl0bGUuaW5uZXJIVE1MID0gJ1Jldmlld3MnO1xyXG4gIGNvbnRhaW5lci5hcHBlbmRDaGlsZCh0aXRsZSk7XHJcblxyXG4gIGlmICghcmV2aWV3cykge1xyXG4gICAgY29uc3Qgbm9SZXZpZXdzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpO1xyXG4gICAgbm9SZXZpZXdzLmlubmVySFRNTCA9ICdObyByZXZpZXdzIHlldCEnO1xyXG4gICAgY29udGFpbmVyLmFwcGVuZENoaWxkKG5vUmV2aWV3cyk7XHJcbiAgICByZXR1cm47XHJcbiAgfVxyXG4gIGNvbnN0IHVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jldmlld3MtbGlzdCcpO1xyXG4gIHJldmlld3MuZm9yRWFjaChyZXZpZXcgPT4ge1xyXG4gICAgdWwuYXBwZW5kQ2hpbGQoY3JlYXRlUmV2aWV3SFRNTChyZXZpZXcpKTtcclxuICB9KTtcclxuICBjb250YWluZXIuYXBwZW5kQ2hpbGQodWwpO1xyXG59XHJcblxyXG4vKipcclxuICogQ3JlYXRlIHJldmlldyBIVE1MIGFuZCBhZGQgaXQgdG8gdGhlIHdlYnBhZ2UuXHJcbiAqL1xyXG5jcmVhdGVSZXZpZXdIVE1MID0gKHJldmlldykgPT4ge1xyXG4gIGNvbnN0IGxpID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnbGknKTtcclxuICBjb25zdCBuYW1lID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpO1xyXG4gIG5hbWUuc2V0QXR0cmlidXRlKFwiY2xhc3NcIiwgXCJyZXYtbmFtZVwiKTtcclxuICBuYW1lLmlubmVySFRNTCA9IHJldmlldy5uYW1lO1xyXG4gIGxpLmFwcGVuZENoaWxkKG5hbWUpO1xyXG5cclxuICBjb25zdCBkYXRlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpO1xyXG4gIGRhdGUuc2V0QXR0cmlidXRlKFwiY2xhc3NcIiwgXCJyZXYtZGF0ZVwiKTtcclxuICBkYXRlLmlubmVySFRNTCA9IHJldmlldy5kYXRlO1xyXG4gIGxpLmFwcGVuZENoaWxkKGRhdGUpO1xyXG5cclxuICBjb25zdCByYXRpbmcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7XHJcbiAgcmF0aW5nLnNldEF0dHJpYnV0ZShcImNsYXNzXCIsIFwicmV2LXJhdGluZ1wiKTtcclxuICByYXRpbmcuaW5uZXJIVE1MID0gYFJhdGluZzogJHtyZXZpZXcucmF0aW5nfWA7XHJcbiAgbGkuYXBwZW5kQ2hpbGQocmF0aW5nKTtcclxuXHJcbiAgY29uc3QgY29tbWVudHMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7XHJcbiAgY29tbWVudHMuc2V0QXR0cmlidXRlKFwiY2xhc3NcIiwgXCJyZXYtY29tbWVudHNcIik7XHJcbiAgY29tbWVudHMuaW5uZXJIVE1MID0gcmV2aWV3LmNvbW1lbnRzO1xyXG4gIGxpLmFwcGVuZENoaWxkKGNvbW1lbnRzKTtcclxuXHJcbiAgcmV0dXJuIGxpO1xyXG59XHJcblxyXG4vKipcclxuICogQWRkIHJlc3RhdXJhbnQgbmFtZSB0byB0aGUgYnJlYWRjcnVtYiBuYXZpZ2F0aW9uIG1lbnVcclxuICovXHJcbmZpbGxCcmVhZGNydW1iID0gKHJlc3RhdXJhbnQ9c2VsZi5yZXN0YXVyYW50KSA9PiB7XHJcbiAgY29uc3QgYnJlYWRjcnVtYiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdicmVhZGNydW1iJyk7XHJcbiAgY29uc3QgbGkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdsaScpO1xyXG4gIGxpLmlubmVySFRNTCA9IHJlc3RhdXJhbnQubmFtZTtcclxuICBicmVhZGNydW1iLmFwcGVuZENoaWxkKGxpKTtcclxufVxyXG5cclxuLyoqXHJcbiAqIEdldCBhIHBhcmFtZXRlciBieSBuYW1lIGZyb20gcGFnZSBVUkwuXHJcbiAqL1xyXG5nZXRQYXJhbWV0ZXJCeU5hbWUgPSAobmFtZSwgdXJsKSA9PiB7XHJcbiAgaWYgKCF1cmwpXHJcbiAgICB1cmwgPSB3aW5kb3cubG9jYXRpb24uaHJlZjtcclxuICBuYW1lID0gbmFtZS5yZXBsYWNlKC9bXFxbXFxdXS9nLCAnXFxcXCQmJyk7XHJcbiAgY29uc3QgcmVnZXggPSBuZXcgUmVnRXhwKGBbPyZdJHtuYW1lfSg9KFteJiNdKil8JnwjfCQpYCksXHJcbiAgICByZXN1bHRzID0gcmVnZXguZXhlYyh1cmwpO1xyXG4gIGlmICghcmVzdWx0cylcclxuICAgIHJldHVybiBudWxsO1xyXG4gIGlmICghcmVzdWx0c1syXSlcclxuICAgIHJldHVybiAnJztcclxuICByZXR1cm4gZGVjb2RlVVJJQ29tcG9uZW50KHJlc3VsdHNbMl0ucmVwbGFjZSgvXFwrL2csICcgJykpO1xyXG59XHJcbiIsInNldFRpbWVvdXQoICgpID0+IHt9LDUwMDApO1xyXG4gIHJlbW92ZVRhYmZvY3VzRnJvbU1hcCA9ICgpID0+IHtcclxuICAgIHdpbmRvdy5vbmxvYWQgPSAoKSA9PntcclxuICAgICAgY29uc3QgZ21hcCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNtYXAnKTtcclxuICAgICAgZ21hcERlc2MgPSBnbWFwLnF1ZXJ5U2VsZWN0b3JBbGwoJyonKTtcclxuICAgICAgZ21hcERlc2MuZm9yRWFjaCggKGRlc2MpID0+e1xyXG4gICAgICAgIGRlc2Muc2V0QXR0cmlidXRlKFwidGFiaW5kZXhcIiwgXCItMVwiKTtcclxuICAgICAgfSwgdGhpcyk7XHJcbiAgICB9XHJcbiAgfVxyXG4gIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwibWFwXCIpLm9ubG9hZCA9IHJlbW92ZVRhYmZvY3VzRnJvbU1hcCgpO1xyXG5cclxuICB3aW5kb3cub25sb2FkID0gKCkgPT57XHJcbiAgICBjb25zdCBpZnJhbWUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdpZnJhbWUnKTtcclxuICAgIGlmcmFtZS50aXRsZSA9IFwiR29vZ2xlIE1hcHNcIjtcclxuICB9XHJcbiIsIlxyXG4vKipcclxuICogUmVnaXN0ZXIgYSBzZXJ2aWNlV29ya2VyXHJcbiAqL1xyXG5yZWdpc3RlclNlcnZpY2VXb3JrZXIgPSAoKSA9PiB7XHJcbiAgICAvL2NoZWNrIGlmIHNlcnZpY2VXb3JrZXIgaXMgc3VwcG9ydGVkLCBvdGhlcndpc2UgcmV0dXJuXHJcbiAgICBpZiAoIW5hdmlnYXRvci5zZXJ2aWNlV29ya2VyKSByZXR1cm47XHJcbiAgXHJcbiAgICBuYXZpZ2F0b3Iuc2VydmljZVdvcmtlci5yZWdpc3RlcignL3N3LmpzJykuY2F0Y2goZnVuY3Rpb24oKXtcclxuICAgICAgY29uc29sZS5sb2coXCJTb21ldGhpbmcgd2VudCB3cm9uZy4gU2VydmljZVdvcmtlciBub3QgcmVnaXN0ZXJlZFwiKTtcclxuICAgIH0pO1xyXG4gIH07XHJcbiAgXHJcbiAgcmVnaXN0ZXJTZXJ2aWNlV29ya2VyKCk7Il19
